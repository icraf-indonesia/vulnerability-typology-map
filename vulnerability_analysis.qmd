---
title: "[DRAFT] Mapping vulnerability to climate change"
author: "Dony Indiarto"
format: 
   html:
    toc: true
    anchor-sections: true
    smooth-scroll: true
editor: visual
---

# Introduction

-   Small farmers are expected to be hit hard by climate change, making their lives even more uncertain. However, we don't have much information on how vulnerable they are or what they need to adjust to these changes

-   One way to help these farmers stay strong is by finding new ways to manage their land that provide financial and environmental benefits.

-   Climate vulnerability assessments play a critical role in identifying the risks these communities face, their root causes, and potential mitigation approaches.

-   These assessments guide the development of resilience strategies, with a focus on livelihood-level interventions, key commodities, and landscape management. In particular, exploring alternative land management options is a promising avenue to bolster resilience, offering both socio-economic and environmental advantages.

# Aim

The aim of this research is to investigate the vulnerability of smallholder farmers in South Sulawesi, Indonesia, to climate-driven agricultural risks and to propose risk management and adaptation strategies that could significantly reduce this vulnerability.

Given the diversity of local contexts in the study sites, we categorised climate vulnerability using secondary socio-economic and biophysical data, we will characterise the vulnerability of these farmers to various risks, both climate-related and otherwise, identify the strategies they currently use to cope with and adapt to these risks, and pinpoint crucial adaptation needs.

# Methodology

## Study area

The South Sulawesi province, located in the southern peninsula of Sulawesi, Indonesia, spans an area of 46,717 square kilometres. The province is characterised by a north-south chain of mountains, topped by volcanic cones and bisected midway by the Tempe Lake valley. The climate is characterised by high rainfall throughout the year, typical of tropical rainforest climates.

South Sulawesi is home to a population of approximately 8.851 million people as of 2019. The province is characterised by a moderate level of income inequality, as reflected in the Gini ratios for its districts, which ranged from around 0.32 to 0.40 in 2022. The province scored 7.22 on the Human Development Index in 2022.

The Gross Domestic Product (GDP) of South Sulawesi was approximately 605.145 billion Indonesian Rupiah in 2022, which is equivalent to around 4,075 million US dollars. This places South Sulawesi as the 9th largest economy among the provinces in Indonesia.

Agriculture plays a significant role in the province's economy, with an estimated one million farmers operating in South Sulawesi, according to the 2018 Survei Pertanian Antar Sensus (SUTAS) conducted by the Badan Pusat Statistik (BPS). Major agricultural products include rice, corn (maize), copra (dried coconut meat), coffee, spices, vegetable oil, sugarcane, soybeans, and sweet potatoes. The forests of the region yield valuable resources such as teak and rattan, and deep-sea fishing also contributes to the local economy.

Potential additional Information:

1.  The poverty and unemployment rates in South Sulawesi.

2.  Information on the changes in climate patterns in South Sulawesi over the past 20-30 years (e.g., changes in temperature, rainfall, droughts).

3.  The impact of these climate changes on food crop production in South Sulawesi.

4.  The frequency and impact of El Nino events in South Sulawesi.

5.  The proportion of smallholders in the total population of South Sulawesi and how they have been affected by climate change and El Nino events.

## Data collection

Understanding the vulnerability of rural smallholder farmers to climate change involves examining a variety of biophysical and socio-economic factors. These factors, represented as grid layers or proxies, are chosen based on literature reviews, field observations, and expert insights. However, not all potential variables are readily available or of sufficient quality for analysis.

These factors are organised into five categories, known as livelihood capitals: natural, physical, human, social, and financial. Each represents a unique aspect that can influence a farmer's vulnerability to climate change.

-   Natural capital includes essential natural resources like forests, rivers, and arable land, as well as climate factors such as temperature and precipitation.

-   Physical capital refers to infrastructure and production resources, including proximity to plantations, roads, and processing facilities.

-   Human capital encompasses the population's knowledge, skills, and health, reflected in variables like village population and unemployment rate.

-   Social capital represents the social networks that provide support and resources to farmers, indicated by factors like the percentage of smallholder agricultural areas in a village.

-   Financial capital involves financial resources, income diversity, and access to credit, represented by variables such as farm size and crop yield.

Each variable has an assumed correlation with vulnerability, either increasing or decreasing it.

```{r Table 1}
#| echo: false
#| warning: false
library(dplyr)
library(readr)
library(kableExtra)

read_csv("data/vulnerability_indicators.csv") |>
  kbl() |> 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), fixed_thead = T,  full_width = F) |> 
    column_spec(2, width = "30em") |> 
    scroll_box(width = "1000px", height = "800px")
```
**Table 1.** Vulnerability indicators with descriptions and data sources.

## Data analysis

Prior to analysis, all grid layers were resampled to a 1 km resolution. The analytical procedure is described in detail below.

### Variable selection

1.  We first examined multi-collinearity among the initial xx raster variables as described in Table 1.

    -   The "pairs" function returned histograms for each raster variable, as well as a scatter plot and Pearson's correlation coefficient (r) for all raster pairs.

    -   We used the scatter plots to determine the amount of non-redundant information contained in two raster pairs.

    -   The correlation coefficients (r) were interpreted in conjunction with the scatter plots to identify which among the collinear variables should be eliminated.

    -   The decision to eliminate collinear variables also relied on expert knowledge regarding their importance in determining the climate-driven vulnerability.

2.  We then standardized the selected raster layers to unit variance and zero mean and combined them into one layer.
library(dplyr)

3.  A random sample of 5000 cells was selected from the standardized raster layers in the stack.

### Principal Component Analysis (PCA)

1.  Using these extracted values, we performed an orthogonal rotation of variables using Principal Components Analysis (PCA) to reduce the dimensions to a few uncorrelated latent variables represented by PCA axes.
2.  We retained only PCA axes with eigenvalues greater than 1 for further analysis, following Kaiser's criterion. This ensured that only PCA axes making a significant contribution were used for further analysis.
3.  We used biplots for the first two PCA axes to further identify collinear variables based on the direction and length of variable arrows.
4.  The factor loadings of variables in PCA axes indicated the strength and direction (negative or positive) of the correlation between variables and particular PCA axes.
5.  We used this information to infer the main bio-socio-economic gradient(s) represented by each PCA axis.
6.  Finally, we generated grid rasters representing the retained PCA axes using the 'predict' function in the 'raster' package and stacked these PCA rasters as one layer.

## Calculating index of climate change vulnerability

The next step is to determine the level of vulnerability across the regions under study. To do this, we employ Principal Component Analysis (PCA) to assign weights to each factor.

The use of equal weights is often deemed too subjective, as research indicates that not all indicators have an equal impact on vulnerability (Hebb and Mortsch, 2007). Relying solely on expert judgement can also be problematic, particularly in smaller communities where expert knowledge may be limited or consensus among experts challenging to achieve (Lowry et al., 1995).

Therefore, we opt for a more objective approach by assigning weights to each factor based on their explained variance, relative to the total variance of the components. This is specifically applied to components with eigenvalues greater than one. This method allows us to aggregate these factors in a way that reflects their relative importance in determining vulnerability.

We therefore use the following formula to summarize all weighted indicators into the single composite index

$$
V_j = \sum_{i=1}^{n} \frac{(w_{i})(x_{ij} - \overline{x}_i)}{s_i} \quad \text{for } i=1, \ldots, n \quad \text{and } j=1
$$

Where: - $V_j$ is the vulnerability index for a specific municipality $j$.

-   $w_{i}$ is the weight for indicator $i$.

-   $x_{ij}$ is the value of indicator $i$ for municipality $j$.

-   $\overline{x}_i$ is the mean value of indicator $i$.

-   $s_i$ is the standard deviation of indicator $i$.

-   The sum is taken over all indicators $i$ from 1 to $n$.

-   The equation holds for all municipalities $j$ from 1 to $J$.

## Cluster analysis and validation (OPTIONAL)

1.  **Choosing the Clustering Algorithm**
    1.  Use the stacked PCA layers (PC1--PC3) as input variables for clustering.
    2.  Determine the most appropriate clustering algorithm and the optimal number of clusters based on inherent data properties using the "cValid" package in R.
    3.  Compare results from cluster analysis with different clustering algorithms and number of clusters.
    4.  Compare K-means and hierarchical clustering algorithms.
2.  **Determining the Optimal Algorithm and Number of Clusters**
    1.  Determine the optimal algorithm and the number of clusters using three cluster stability indices implemented in "cValid" R package: average distance (AD), average distance between means (ADM), and figure of merit (FOM).
    2.  Evaluate the consistency of a clustering results by comparing it with results of clusters generated after a column of data is sequentially removed, one at a time.
3.  **Evaluating the Accuracy of Clustering**
    1.  Evaluate the accuracy of clustering using within-cluster (WSS), between-cluster (BSS) and total sum of squared distances (TSS).
    2.  Calculate the variance explained by the 3 PCA rasters in cluster analysis by dividing the total BSS by TSS distances.
4.  **Establishing Threshold Criteria**
    1.  Use Multivariate regression trees (MRTs) to establish threshold criteria and to identify the most important gradients in discriminating specific clusters.
    2.  Select a stratified sample of 5000 pixels from each cluster (n = 100000 pixels) and use it to extract values of the three PCA raster layers.
    3.  Form a matrix with four variables: clusters (categorical) and three continuous environmental variables with values of the three PCA layers (PC1 − PC3).
5.  **Fitting the MRT Model**
    1.  Fit a MRT model using 'mvpart' package in R. The categorical variable representing the clusters is the response and the three PCA axes are predictors.
    2.  Assess the quality of the splits in the tree using the relative error (RE), which is the final error relative to error of the initial unsplit tree.
    3.  Select the best MRT based on cross-validated relative error (CVRE) that indicated the ability of the MRT to predict PCA values for new clusters.
    4.  Deductively interpret the identification of the most important bio-socioeconomic gradient (PCA axis) discriminating a particular cluster using the threshold criteria and the discriminant cluster indicated in the tree.
